"use strict";angular.module("ngScaffoldApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","uiGmapgoogle-maps"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/tree/sidor"),a.state("tree",{url:"/tree/:path",controller:"TreeCtrl",templateUrl:"views/tree/tree-view.html"}),a.state("html",{url:"/html/:path",controller:"HtmlCtrl",templateUrl:"views/html/html-view.html"})}]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({key:"AIzaSyB1t3KIHZN93NqVZjvLaXW3X8buZuuxCbc",v:"3.17",libraries:"weather,geometry,visualization"})}]).filter("reverse",function(){return function(a){return a.slice().reverse()}}),angular.module("ngScaffoldApp").controller("AppCtrl",["$scope","$timeout",function(a,b){return a.$on("alert",function(c,d){var e;return b.cancel(e),a.alert=d,e=b(function(){a.alert={}},2e3)})}]),angular.module("ngScaffoldApp").factory("DataFactory",["$http",function(a){var b,c;return c=function(b){return a.get("http://localhost:3000/static/json/"+b)},b=function(b){return a.get("http://localhost:3000/static/html/"+b)},{getJSON:c,getHTML:b}}]),angular.module("ngScaffoldApp").factory("UrlFactory",[function(){var a,b;return b=function(a){return a.replace(/&046/g,".").replace(/&047/g,"/")},a=function(a){return a.replace(/\./g,"&046").replace(/\//g,"&047")},{encode:b,decode:a}}]),angular.module("ngScaffoldApp").factory("DB",["$http",function(a){var b,c,d,e,f,g,h,i;return i=function(b,c){return a.put("http://localhost:3000/collections/tree/"+b,c)},e=function(b,c){return a.get("http://localhost:3000/collections/map/"+b+"/"+c)},c=function(b){return a.get("http://localhost:3000/collections/"+b)},d=function(b,c){return a.get("http://localhost:3000/collections/"+b+"/"+c)},g=function(b,c){return a.post("http://localhost:3000/collections/"+b,c)},h=function(b,c,d){return a.put("http://localhost:3000/collections/"+b+"/"+c,d)},f=function(b){return a.get("http://localhost:3000/collections/tree/"+b)},b=function(b,c){return a["delete"]("http://localhost:3000/collections/"+b+"/"+c)},{updateNode:i,getPlace:e,get:c,getById:d,post:g,put:h,getTree:f,"delete":b}}]),angular.module("ngScaffoldApp").factory("FilterFactory",["$q","DB",function(a,b){var c,d,e,f;return d=function(a,b,c){return a.path===b.path?a.status=c:void 0},c=function(a,b,c){var f,g,h,i;for(a.children&&e(a.children,b,c),i=[],g=0,h=b.length;h>g;g++)f=b[g],i.push(d(a,f,c));return i},e=function(a,b,d){var e,f,g;for(f=0,g=a.length;g>f;f++)e=a[f],c(e,b,d);return a},f=function(c){return a(function(a){return b.get("trash").then(function(b){return console.log(e(c.data,b.data,"trash")),a(c)})})},{tree:f}}]),angular.module("ngScaffoldApp").factory("Utils",[function(){var a,b,c,d,e;return d=function(a){return a.base.indexOf(".")<0},e=function(a,b){return a.splice(a.indexOf(b),1)},a=function(a,b){return a.push(b)},b=function(a,b){return a.indexOf(b)>-1},c=function(a){var b,c;b=[];for(c in a)b.push(a[c].text);return _.uniq(b)},{isFolder:d,removeFromArr:e,addToArr:a,arrHas:b,flattenObj:c}}]),angular.module("ngScaffoldApp").controller("TreeCtrl",["$scope","$sce","$stateParams","DB","UrlFactory",function(a,b,c,d,e){var f;return a.openfolders=[],f=function(){return d.getTree(e.decode(c.path)).then(function(b){return a.node=b})},a.openitem=function(a){return d.getById("items",a).then(function(a){return console.log(a)})},a.openfile=function(c){return a.htmlurl="#/html/"+b.trustAsResourceUrl(e.decode(c))},a.closefile=function(){return a.htmlurl=""},a.toggledone=function(a,b){return d.updateNode(e.decode(a),{done:b}).then(function(){return f()},function(){return f()})},a.addtotrash=function(a){return d.updateNode(e.decode(a),{trashed:!0}).then(function(){return f()},function(){return f()})},f()}]),angular.module("ngScaffoldApp").controller("HtmlCtrl",["$scope","$stateParams","DataFactory","UrlFactory",function(a,b,c,d){return a.url=d.decode(b.path),a.$on("addItem",function(b,c){return a.item=c}),c.getHTML(b.path).then(function(b){return a.html=b.data})}]),angular.module("ngScaffoldApp").directive("node",function(){return{restrict:"E",replace:!0,scope:{nodes:"=",addtotrash:"=",openfile:"=",closefile:"=",openfolders:"=",openitem:"=",toggledone:"="},templateUrl:"/modules/node/node-tmplt.html"}}),angular.module("ngScaffoldApp").directive("nodeChild",["$compile","$rootScope","UrlFactory","DB","Utils",function(a,b,c,d,e){return{restrict:"E",replace:!0,scope:{child:"=",addtotrash:"=",openfile:"=",closefile:"=",openfolders:"=",openitem:"=",toggledone:"="},templateUrl:"/modules/node/node-child-tmplt.html",link:function(b,f){var g,h;g=function(){return d.getTree(c.decode(b.child._id)).then(function(c){return b.children=c,a('<node nodes="children" addtotrash="addtotrash" openfile="openfile" closefile="closefile" openfolders="openfolders" openitem="openitem" toggledone="toggledone" > </node>')(b,function(a){return f.append(a)})})},b.decode=c.decode,b.isFolder=e.isFolder,h=b.toggleFolder=function(){var a;a=f.find("ul"),a.length>0?(a.hasClass("hidden")&&!e.arrHas(b.openfolders,b.child._id)?e.addToArr(b.openfolders,b.child._id):e.removeFromArr(b.openfolders,b.child._id),a.toggleClass("hidden")):(e.arrHas(b.openfolders,b.child._id)||e.addToArr(b.openfolders,b.child._id),g())},e.arrHas(b.openfolders,b.child._id)&&h()}}}]),angular.module("ngScaffoldApp").directive("htmlTool",["UrlFactory","Utils",function(a,b){return{restrict:"E",replace:!0,scope:{html:"=",url:"=",item:"="},templateUrl:"/modules/htmlTool/html-tool-tmplt.html",link:function(c){c.types={people:c.html.people,years:c.html.years,streets:c.html.streets},c.goTo=function(a,b){var c;c=document.querySelectorAll("."+b+"-"+a)[0],c.scrollIntoView({block:"end",behavior:"smooth"}),c.classList.add("in-view"),window.setTimeout(function(){return c.classList.remove("in-view")},2e3)},c.encode=a.encode,c.addText=function(a){var d;return d={type:"text",url:a,years:b.flattenObj(c.html.years),people:b.flattenObj(c.html.people),parent:c.encode(c.url)},c.$emit("addItem",d)},c.addImage=function(a){var d;d={type:"image",node:a,years:b.flattenObj(c.html.years),people:b.flattenObj(c.html.people),parent:c.encode(c.url)},c.$emit("addItem",d)}}}}]),angular.module("ngScaffoldApp").directive("map",["$log","$q","DB","MapService","UrlFactory",function(a,b,c,d,e){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/modules/map/map-tmplt.html",link:function(a){var f,g,h,i;return a.activeMarker="",a.newPlace={},a.selectedPeople={},a.selectedYears={},a.markers=[],f=function(){var b,d;return b=a.item.people,d=a.item.years,c.getById("items","54c9fe94628f8b07936ece97").then(function(c){var e,f;for(f in c.data.years)a.selectedYears[c.data.years[f]]=!0;for(e in c.data.people)a.selectedPeople[c.data.people[e]]=!0;return c.data.years=_.union(c.data.years,d),c.data.people=_.union(c.data.people,b),a.item=c.data})},i=function(){return c.get("map").then(function(b){return a.newPlace="",a.markers=b.data,a.$emit("alert",{type:"success",message:"Map Updated"})})},g=function(d){var e,f,g;g=_.find(a.markers,{_id:d.key}),f=[];for(e in g.items)f.push(c.getById("items",g.items[e]));return b.all(f).then(function(b){return a.activeMarker.items=b}),a.$apply(function(){return a.activeMarker={id:d.key,name:g.name,coords:g.longitude+","+g.latitude},a.newPlace=""})},h=function(b,c,d){return a.$apply(function(){return a.newPlace={coords:{latitude:d[0].latLng.k,longitude:d[0].latLng.C}},a.activeMarker=""})},a.marker={events:{click:g}},a.map={center:{latitude:63.52218,longitude:22.530485},zoom:14,options:{scrollwheel:!1},events:{click:h}},a.addPerson=function(b){return a.selectedPeople[b]=!0,a.item.people.push(b)},a.addYear=function(b){return a.selectedYears[b]=!0,a.item.years.push(b)},a.updateItem=function(b){return d.updateItem(b,a.selectedPeople,a.selectedYears).then(function(){return a.$emit("alert",{type:"success",message:"Item Updated"})})},a.addNew=function(f,g){return d.addItem(f,a.selectedPeople,a.selectedYears).then(function(a){var d;return d=[c.updateNode(e.decode("/apple-touch-icon.png"),{itemId:a.data[0]._id}),c.post("map",{name:g.name,latitude:g.coords.latitude,longitude:g.coords.longitude,items:[a.data[0]._id]})],b.all(d)}).then(function(){return i()})},a.removeItemFromPlace=function(a,b){return c.put("map",b,{$pull:{items:a._id}}).then(function(){return i()})},a.updateItemToNewPlace=function(b,e){return d.updateItem(b,a.selectedPeople,a.selectedYears).then(function(){return c.post("map",{name:e.name,latitude:e.coords.latitude,longitude:e.coords.longitude,items:[b._id]})}).then(function(){return i()},function(a){return console.log(a)})},a.updatePlace=function(b,e){return d.addItem(b,a.selectedPeople,a.selectedYears).then(function(a){return c.put("map",e,{$addToSet:{items:a.data[0]._id}})}).then(function(){return i()})},a.updateItemToMarker=function(b,e){return d.updateItem(b,a.selectedPeople,a.selectedYears).then(function(){return c.put("map",e,{$addToSet:{items:b._id}})}).then(function(){return i()})},a.cancel=function(){return a.$emit("addItem","")},a.deletePlace=function(a){return c["delete"]("map",a.id).then(function(){return i()})},i(),f()}}}]),angular.module("ngScaffoldApp").directive("mapItem",["$log","$q","DB",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/modules/map/map-item-tmplt.html"}}]),angular.module("ngScaffoldApp").directive("mapItems",["$log","$q","DB",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/modules/map/map-items-tmplt.html"}}]),angular.module("ngScaffoldApp").directive("mapPlace",["$log","$q","DB",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/modules/map/map-place-tmplt.html"}}]),angular.module("ngScaffoldApp").factory("MapService",["DB",function(a){var b,c;return b=function(b,c,d){var e,f,g,h,i;g=[];for(f in c)c[f]&&g.push(f);h=[];for(i in d)d[i]&&h.push(i);return b.node&&(e=b.node.src.www),a.post("items",{parent:b.parent,url:b.url,name:b.name,src:e,type:b.type,people:g,years:h})},c=function(b,c,d){var e,f,g,h,i;g=[];for(f in c)c[f]&&g.push(f);h=[];for(i in d)d[i]&&h.push(i);return b.node&&(e=b.node.src.www),a.put("items",b._id,{parent:b.parent,url:b.url,name:b.name,src:e,type:b.type,people:g,years:h})},{addItem:b,updateItem:c}}]);